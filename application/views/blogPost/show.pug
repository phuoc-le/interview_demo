extends ../layout

block content
  h1= post.title
  p= post.content
  p
    small Posted by #{post.author} on #{new Date(post.createdAt).toLocaleDateString()}

  // Links for navigation and edit
  a.btn.btn-primary.d-inline-block.me-1(href='/blog/list') Back to blog posts
  a.btn.btn-warning.d-inline-block.me-1(href='/blog/' + post._id + '/edit') Edit

  // Form for delete
  form(onSubmit=`deleteItem('${post._id}', event)`, class='d-inline-block')
    input(type='hidden', name='_csrf', value=_csrf)
    button.btn.btn-danger(type='submit') Delete

  // JavaScript for delete action using Axios
  script.
    function deleteItem(itemId, event) {
        // Prevent form from submitting and reloading the page
        event.preventDefault();

        var result = confirm("Are you sure you want to delete this item?");
        if (result) {
            // CSRF token
            const csrfToken = document.querySelector('input[name="_csrf"]').value;

            // Use Axios to send delete request
            axios.post(`http://localhost:8080/blog-post/${itemId}/delete`, {}, {
                headers: {
                    'CSRF-Token': csrfToken, // Add CSRF token in the request header
                    'Content-Type': 'application/json'
                }
            })
            .then(function(response) {
                console.log('Delete successful:', response.data);
                // On success, redirect to the blog list
                window.location.href = "/blog/list";
            })
            .catch(function(error) {
                debugger; //
                console.error("Error response:", error.response);
                console.error("Error message:", error.message);
                alert("There was an error. Please try again.");
            });
        }
    }
